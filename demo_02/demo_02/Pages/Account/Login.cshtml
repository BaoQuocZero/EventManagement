@page
@model LoginModel
@{
    Layout = null;
}

<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="utf-8" />
    <title>Đăng nhập</title>
    <link rel="stylesheet" href="https://cdn3.devexpress.com/jslib/23.1.5/css/dx.light.css" />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn3.devexpress.com/jslib/23.1.5/js/dx.all.js"></script>
    <link rel="stylesheet" href="~/css/login.css" />
</head>
<body>
    <div class="login-container">
        <div class="login-box">
            <h2>Đăng nhập</h2>
            <div id="login-form"></div>
            <div id="error-message" class="error-message"></div>
            <div id="login-button"></div>
        </div>
    </div>

    <script>
        $(function () {
            var formInstance = $("#login-form").dxForm({
                formData: {
                    loginInfo: "",
                    password: ""
                },
                items: [
                    {
                        dataField: "loginInfo",
                        label: { text: "Email hoặc Số điện thoại" },
                        editorType: "dxTextBox",
                        editorOptions: {
                            placeholder: "Nhập email hoặc số điện thoại...",
                            mode: "text"
                        },
                        validationRules: [{ type: "required", message: "Vui lòng nhập email hoặc số điện thoại" }]
                    },
                    {
                        dataField: "password",
                        label: { text: "Mật khẩu" },
                        editorType: "dxTextBox",
                        editorOptions: {
                            mode: "password",
                            placeholder: "Nhập mật khẩu..."
                        },
                        validationRules: [{ type: "required", message: "Vui lòng nhập mật khẩu" }]
                    }
                ]
            }).dxForm("instance");

            $("#login-button").dxButton({
                text: "Đăng nhập",
                type: "default",
                width: "100%",
                onClick: function () {
                    var formData = formInstance.option("formData");

                    if (!formData.loginInfo || !formData.password) {
                        $("#error-message").text("Vui lòng nhập đầy đủ thông tin.");
                        return;
                    }

                    $("#login-button").dxButton("instance").option("disabled", true);

                    $.ajax({
                        url: "@Url.Page("/Account/Login")",
                        type: "POST",
                        contentType: "application/json",
                        data: JSON.stringify(formData),
                        success: function (response) {
                            if (response.success) {
                                window.location.href = "/";
                            } else {
                                $("#error-message").text("Thông tin đăng nhập không chính xác.");
                                $("#login-button").dxButton("instance").option("disabled", false);
                            }
                        },
                        error: function () {
                            $("#error-message").text("Lỗi hệ thống, vui lòng thử lại.");
                            $("#login-button").dxButton("instance").option("disabled", false);
                        }
                    });
                }
            });
        });
    </script>
</body>
</html>
